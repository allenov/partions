<p># partions<br />создали таблицу с партированием <br />CREATE TABLE bookings_range (<br />book_ref character(6),<br />book_date timestamptz,<br />total_amount numeric(10,2)<br />) PARTITION BY RANGE(book_date);<br /><br />создали инетесующие нас отрезки по месяцам<br />CREATE TABLE bookings_range_201706 PARTITION OF bookings_range <br />FOR VALUES FROM ('2017-06-01'::timestamptz) TO ('2017-07-01'::timestamptz);<br />CREATE TABLE bookings_range_201707 PARTITION OF bookings_range <br />FOR VALUES FROM ('2017-07-01'::timestamptz) TO ('2017-08-01'::timestamptz);<br />CREATE TABLE bookings_range_201606 PARTITION OF bookings_range <br />FOR VALUES FROM ('2016-06-01'::timestamptz) TO ('2016-07-01'::timestamptz);<br />CREATE TABLE bookings_range_201607 PARTITION OF bookings_range <br />FOR VALUES FROM ('2016-07-01'::timestamptz) TO ('2016-08-01'::timestamptz);<br />CREATE TABLE bookings_range_201608 PARTITION OF bookings_range <br />FOR VALUES FROM ('2016-08-01'::timestamptz) TO ('2016-09-01'::timestamptz);<br />CREATE TABLE bookings_range_201609 PARTITION OF bookings_range <br />FOR VALUES FROM ('2016-09-01'::timestamptz) TO ('2016-10-01'::timestamptz);<br />CREATE TABLE bookings_range_201610 PARTITION OF bookings_range <br />FOR VALUES FROM ('2016-10-01'::timestamptz) TO ('2016-11-01'::timestamptz);</p>
<p><br />\d+ bookings_range<br />Partitioned table "bookings.bookings_range"<br />Column | Type | Collation | Nullable | Default | Storage | Stats target | Description <br />--------------+--------------------------+-----------+----------+---------+----------+--------------+-------------<br />book_ref | character(6) | | | | extended | | <br />book_date | timestamp with time zone | | | | plain | | <br />total_amount | numeric(10,2) | | | | main | | <br />Partition key: RANGE (book_date)<br />Partitions: bookings_range_201606 FOR VALUES FROM ('2016-06-01 00:00:00+00') TO ('2016-07-01 00:00:00+00'),<br />bookings_range_201607 FOR VALUES FROM ('2016-07-01 00:00:00+00') TO ('2016-08-01 00:00:00+00'),<br />bookings_range_201608 FOR VALUES FROM ('2016-08-01 00:00:00+00') TO ('2016-09-01 00:00:00+00'),<br />bookings_range_201609 FOR VALUES FROM ('2016-09-01 00:00:00+00') TO ('2016-10-01 00:00:00+00'),<br />bookings_range_201610 FOR VALUES FROM ('2016-10-01 00:00:00+00') TO ('2016-11-01 00:00:00+00'),<br />bookings_range_201706 FOR VALUES FROM ('2017-06-01 00:00:00+00') TO ('2017-07-01 00:00:00+00'),<br />bookings_range_201707 FOR VALUES FROM ('2017-07-01 00:00:00+00') TO ('2017-08-01 00:00:00+00'),<br />bookings_range_201708 FOR VALUES FROM ('2017-08-01 00:00:00+00') TO ('2017-09-01 00:00:00+00')</p>
<p>вставили данные <br />INSERT INTO bookings_range SELECT * FROM bookings;</p>
<p>SELECT * FROM bookings_range WHERE book_date = '2017-07-02'::timestamptz;<br />book_ref | book_date | total_amount <br />----------+------------------------+--------------<br />1C25D5 | 2017-07-02 00:00:00+00 | 133100.00<br />89A1D4 | 2017-07-02 00:00:00+00 | 102300.00<br />989791 | 2017-07-02 00:00:00+00 | 72400.00<br />DDBAE0 | 2017-07-02 00:00:00+00 | 38600.00<br />(4 rows)</p>
<p><br />explain SELECT * FROM bookings_range WHERE book_date = '2017-07-02'::timestamptz;<br />QUERY PLAN <br />----------------------------------------------------------------------------------------<br />Seq Scan on bookings_range_201707 bookings_range (cost=0.00..3156.85 rows=5 width=21)<br />Filter: (book_date = '2017-07-02 00:00:00+00'::timestamp with time zone)<br />(2 rows)</p>
